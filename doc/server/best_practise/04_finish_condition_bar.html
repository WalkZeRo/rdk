<!DOCTYPE html>
<html>
<head>
<title>04_finish_condition_bar</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
</head>
<body>
<h2>目标与收获</h2>
<p>本小节将完成 <code>my_first_app</code> 的条件查询栏剩余部分，通过本小结的学习，你将了解到</p>
<ul>
<li>ComboSelect控件</li>
<li>BasicSelector控件</li>
</ul>
<h2>修改</h2>
<p>BA告诉我们，这个功能的查询条件除了时间段以外，还有一个地市选择框。当然我们还需要有一个查询按钮可以触发一次查询。</p>
<h3>增加地市选择框</h3>
<p>Ux团队要求我们把时段框，地市框，查询按钮这3个控件放在一行上，并且地市框是一个下拉框，因此我们需要将这3个东西放在一个div里头。</p>
<p>编辑 <code>app/my_first_app/web/index.html</code> 文件，把body节点修改为：</p>
<pre><code>&lt;body ng-controller='rdk_ctrl' class=&quot;rdk_main&quot;&gt;
    &lt;div&gt;
        &lt;rdk_time range setting=&quot;timeSetting&quot;&gt;&lt;/rdk_time&gt;
        &lt;rdk_combo_select caption=&quot;'地市'&quot;&gt;
            &lt;rdk_basic_selector data=&quot;citys&quot; multiple_select=&quot;true&quot; label_field=&quot;name&quot; track_item_by=&quot;id&quot; editable=&quot;false&quot;&gt;
            &lt;/rdk_basic_selector&gt;
        &lt;/rdk_combo_select&gt;
    &lt;/div&gt;


    &lt;!-- 在页面渲染完成之前，显示在界面上，防止页面抖动 --&gt;
    &lt;!--     这个节点可选，删除后，RDK会自动生成一个    --&gt;
    &lt;!--           这个节点只支持基本HTML标签           --&gt;
    &lt;rdk_loading&gt;
        &lt;img src=&quot;images/loding.gif&quot; alt=&quot;loading...&quot;/&gt;
    &lt;/rdk_loading&gt;
&lt;/body&gt;
</code></pre>

<p>页面其他部分保持不变。我们碰到两个新的控件，分别是 <a href="/doc/client/controls/comboselect/index.html"><code>ComboSelect</code></a> 和 <a href="/doc/client/controls/basicselector/index.html"><code>BasicSelector</code></a>，在页面上引用之后，还需要注入对他们的依赖才能生效，<a href="03_use_first_control.html#dep-inject">参考这里</a>。</p>
<p>编辑 <code>app/my_first_app/web/scripts/main.js</code>，增加<a href="/doc/client/controls/comboselect/index.html"><code>ComboSelect</code></a>和<a href="/doc/client/controls/basicselector/index.html"><code>BasicSelector</code></a>这两个控件的依赖，具体操作方法和上一步类似，修改后的代码为：</p>
<pre><code>define('main', ['application', 'utils', 'i18n', 'blockUI',
    'rd.controls.Time', 'rd.controls.ComboSelect', 'rd.controls.BasicSelector'],
function(application, utils, i18n) {
// 创建一个RDK的应用
var app = angular.module(&quot;rdk_app&quot;, ['rd.core', 'blockUI',
    'rd.controls.Time', 'rd.controls.ComboSelect', 'rd.controls.BasicSelector']);

...

});
</code></pre>

<p><a name="city-mock-data"></a>
然后，给地市选择框提供备选项：</p>
<pre><code>scope.citys = [
    {id: 1, name: '南京'},
    {id: 2, name: '扬州'},
    {id: 3, name: '苏州'},
    {id: 4, name: '镇江'},
]
</code></pre>

<blockquote>
<p>注意<br>
一般来说，地市的备选项是需要从服务端查询得到的，这里为了调试界面能够正常显示，直接写死，这个问题留在后续步骤解决。</p>
</blockquote>
<h3>添加查询按钮</h3>
<p>我们直接使用bootstrap风格的按钮即可。编辑 <code>app/my_first_app/web/index.html</code> 文件，在div的最后追加上下面这行代码</p>
<pre><code>&lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot;&gt;查询&lt;/button&gt;
</code></pre>

<p>保存后刷新浏览器，我们就得到一个简单的查询条件栏了，此时页面看起应该是这样的
<img src="img/condition.PNG" /></p>
<h3>地市显示异常</h3>
<p>此时刷新页面后，选中任意一个地市，地市框显示异常：</p>
<p><img src="img/city_error.PNG" /></p>
<p>这是<a href="/doc/client/controls/comboselect/index.html"><code>ComboSelect</code></a>控件不识别我们地市的数据结构导致的，需要增加一个属性告诉<a href="/doc/client/controls/comboselect/index.html"><code>ComboSelect</code></a>控件如何识别一个地市。</p>
<p>修改页面代码，找到 <code>rdk_combo_select</code> 节点，添加一个新的属性，代码为：</p>
<pre><code>child_change=&quot;selected2string&quot;
</code></pre>

<p><code>child_change</code> 的值是一个 名为 <code>selected2string</code> 的函数，我们需要将它定义在scope对象上。编辑js脚本，添加上 <code>selected2string</code> 的定义，代码为：</p>
<pre><code>scope.selected2string = function(selected, context, index) {
    var selectedCitys = '';
    angular.forEach(selected, function(city) {
        selectedCitys += city.name + ' ';
    });
    return selectedCitys;
}
</code></pre>

<blockquote>
<p>扩展：<br>
angular.forEach是angular提供的一个遍历函数，很有用，<a href="http://docs.ngnice.com/api/ng/function/angular.forEach">访问这里</a>可以了解更多。站点 <a href="http://docs.ngnice.com/api">http://docs.ngnice.com/api</a> 提供了AngularJS所有文档，建议仔细阅读。</p>
</blockquote>
<h3>样式调整</h3>
<p>看起来条件框中所有的元素都挤在一起，我们可以增加一些留白，让每个控件看起来更独立一些。为了简单，我们直接使用style属性，你也可以在css文件中定义样式。</p>
<p>给时间控件和ComboSelect控件增加一个这样的属性 <code>style=&quot;margin-right:30px&quot;</code></p>
<h2>小结</h2>
<p>我们完成了查询条件栏的剩余部分，碰到了两个新的RDK控件：<a href="/doc/client/controls/comboselect/index.html"><code>ComboSelect</code></a>和<a href="/doc/client/controls/basicselector/index.html"><code>BasicSelector</code></a></p>
<p>你可以下载完成此步骤之后的<a href="04_finish_condition_bar.zip">源码</a>，解压到 <code>app/my_first_app</code> 下，<a href="/rdk/app/my_first_app/web/index.html">单击这里</a>就可以打开它了。</p>
<div title="第4步 完成查询条件栏 - RDK应用开发最佳实践" id="__hidden__">
<script src="/doc/tools/doc_js/misc.js"></script>
</div>
</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
